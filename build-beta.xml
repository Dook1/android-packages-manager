<?xml version="1.0" encoding="UTF-8"?>
<project default="release">
	<tstamp>
		<format property="TODAY_UK" pattern="yyyy_MM_dd" locale="en,UK" />
	</tstamp>

	<property file="build.properties" />
	<property name="path_libs" value="builds/apm-core" />
	<property name="app.build.jar.path" value="${path_libs}/beta/${app.build.jar.name}.jar" />
	<property name="app.build.currentversion.path" value="${path_libs}/beta/${app.build.jar.name}.jar" />


	<property name="app.build" value="bin" />
	<property name="app.build.bin" value="${app.build}/bin" />
	<property name="app.build.src" value="${app.build}/src-core" />
	<property name="app.libs" value="" />
	<property name="app.src" value="src-core" />


	<target name="release" depends="clean,compile,build-jar,clean_bin">
		<echo>Finished</echo>
	</target>

	<target name="clean">
		<delete dir="${app.build.bin}" />
		<delete dir="${app.build.src}" />
	</target>
	<target name="clean_bin">
	    <delete dir="${app.build.bin}" />
		<delete dir="${app.build.src}" />
	</target>

	<target name="create-dir">
		<mkdir dir="${app.build}" />
		<mkdir dir="${app.build.src}" />
		<mkdir dir="${app.build.bin}" />
	</target>

	<target name="copy">
		<copy todir="${app.build.src}" overwrite="true">
			<fileset dir="${app.src}" includes="**/*" />
		</copy>
	</target>
	<target name="precompile" depends="clean,create-dir,copy">
		<replace dir="${app.build.src}" encoding="UTF-8">
			<replacefilter token="%%VERSION%%" value="${app.build.verision}.${app.build.number}(beta)" />
		</replace>

		<echo>Finished</echo>
	</target>

	<target name="compile" depends="precompile">
		<javac srcdir="${app.build.src}" destdir="${app.build.bin}" classpath="${app.libs}" includeantruntime="false" debug="off" encoding="UTF-8">
		</javac>
		<copy todir="${app.build.bin}">
		    <fileset dir="${app.build.src}" includes="**/*.*" excludes="**/*.java" />
		</copy>
	</target>

	<target name="build-jar" depends="">

		<delete file="${app.build.jar.path}" />
		<jar destfile="${app.build.jar.path}">
			<fileset dir="${app.build.bin}" includes="**/*.*" excludes="com/adbhelper/*.class" />
			<manifest>
				<attribute name="Manifest-Version" value="1.0" />
				<attribute name="Class-Path" value="." />
				<attribute name="Built-By" value="Vladimir Baraznovsky" />
				<section name="common">
					<attribute name="Specification-Version" value="${app.build.verision}-beta" />
					<attribute name="Implementation-Version" value="${app.build.verision} Build ${app.build.number}(beta) ${TODAY}" />
				</section>
			</manifest>
		</jar>
	</target>

</project>